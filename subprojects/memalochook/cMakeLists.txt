# subprojects/memalochook/CMakeLists.txt

set(MI_BUILD_SHARED OFF CACHE BOOL "Buduj mimalloc jako bibliotekę statyczną")
set(MI_BUILD_TESTS OFF CACHE BOOL "Nie buduj testów mimalloc")

add_library(memalochook SHARED
    main.cpp
)

target_include_directories(memalochook PRIVATE
    "${CMAKE_SOURCE_DIR}/include/minhook/include"
)

if(MSVC)
    set_target_properties(memalochook PROPERTIES
        MSVC_RUNTIME_LIBRARY "MultiThreaded"
    )
endif()

target_link_libraries(memalochook PRIVATE
    "${CMAKE_SOURCE_DIR}/include/minhook/lib/libMinHook.x86.lib"
)

if(MSVC)
    set(CMAKE_CXX_FLAGS_RELEASE "/O2 /Zi /DNDEBUG /W4")
    set(CMAKE_CXX_FLAGS_DEBUG "/Od /Zi /D_DEBUG /W4")
endif()

target_compile_options(memalochook PRIVATE
    "/Zi"
)

set_target_properties(memalochook PROPERTIES
    PDB_NAME "memalochook"
    DEBUG_INFORMATION_RELEASE TRUE
)

target_link_options(memalochook PRIVATE "/DEBUG")
