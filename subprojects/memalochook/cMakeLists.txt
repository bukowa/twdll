add_subdirectory("${CMAKE_SOURCE_DIR}/include/minhook" "${CMAKE_BINARY_DIR}/minhook")

add_library(memalochook SHARED main.cpp)

target_include_directories(memalochook PRIVATE
    "${CMAKE_SOURCE_DIR}/include/minhook/include"
)

target_link_libraries(memalochook PRIVATE minhook shlwapi)

if(MSVC)
    message(STATUS "Configuring for MSVC compiler")

    set(STATIC_MSVC_RUNTIME "MultiThreaded$<$<CONFIG:Debug>:Debug>")

    set_target_properties(memalochook PROPERTIES
        MSVC_RUNTIME_LIBRARY ${STATIC_MSVC_RUNTIME}
    )
    set_target_properties(minhook PROPERTIES
        MSVC_RUNTIME_LIBRARY ${STATIC_MSVC_RUNTIME}
    )

    target_compile_options(memalochook PRIVATE
        /W4          # Warning level 4
        /EHsc        # Standard exception handling
        /arch:SSE2
    )

    target_compile_options(memalochook PRIVATE
        $<$<CONFIG:Release>:/O2 /Ot /fp:fast>
        $<$<CONFIG:Debug>:/Od>
    )

    target_link_options(memalochook PRIVATE
        /DEBUG
    )

endif()